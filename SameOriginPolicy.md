# <center>跨域 </center>

## 同源策略及限制内容
1. 同源是指"协议+域名+端口"三者相同，即便两个不同的域名指向同一个ip地址，也非同源。
2. 同源策略限制内容有：
   - Cookie、LocalStorage、IndexedDB 等存储性内容
   - DOM 节点
   - AJAX 请求发送后，结果被浏览器拦截了

3. 三个标签是允许跨域加载资源：
   ```html
   <img src=XXX>
   <link href=XXX>
   <script src=XXX>
   ```
4. 说明
   - 如果是协议和端口造成的跨域问题“前台”是无能为力的。
   - 在跨域问题上，仅仅是通过“URL的首部”来识别而不会根据域名对应的IP地址是否相同来判断。“URL的首部”可以理解为“协议, 域名和端口必须匹配”。
   - 跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了。跨域并不能完全阻止 CSRF，因为请求毕竟是发出去了.

## 解决方案
### 1. jsonp
1) JSONP原理
利用 `<script>` 标签没有跨域限制的漏洞，网页可以得到从其他来源动态产生的 JSON 数据。JSONP请求一定需要对方的服务器做支持才可以。AJAX属于同源策略，JSONP属于非同源策略（跨域请求）。

2) JSONP优缺点：JSONP优点是简单兼容性好，可用于解决主流浏览器的跨域数据访问的问题。缺点是仅支持get方法具有局限性,不安全可能会遭受XSS攻击。
 
3) JSONP都是GET和异步请求的，不存在其他的请求方式和同步请求，且jQuery默认就会给JSONP的请求清除缓存。

### 2. 跨域资源共享CORS [Cross-origin resource sharing]
服务端设置 Access-Control-Allow-Origin 就可以开启 CORS。 该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。

1) 简单请求: 只要同时满足以下两大条件，就属于简单请求
   - 条件1：使用下列方法之一：GET、HEAD、POST
   - 条件2：Content-Type 的值仅限于下列三者之一：
        - text/plain
        - multipart/form-data
        - application/x-www-form-urlencoded
请求中的任意 XMLHttpRequestUpload 对象均没有注册任何事件监听器； XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。

2) 复杂请求: 不符合以上条件的请求就肯定是复杂请求了。
复杂请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为"预检"请求,该请求是 option 方法的，通过该请求来知道服务端是否允许跨域请求。

```html
// index.html
let xhr = new XMLHttpRequest()
document.cookie = 'name=xiamen' // cookie不能跨域
xhr.withCredentials = true // 前端设置是否带cookie
xhr.open('PUT', 'http://localhost:4000/getData', true)
xhr.setRequestHeader('name', 'xiamen')
xhr.onreadystatechange = function() {
  if (xhr.readyState === 4) {
    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
      console.log(xhr.response)
      //得到响应头，后台需设置Access-Control-Expose-Headers
      console.log(xhr.getResponseHeader('name'))
    }
  }
}
xhr.send()
```

```js
//server1.js
let express = require('express');
let app = express();
app.use(express.static(__dirname));
app.listen(3000);
```
```js
//server2.js
let express = require('express')
let app = express()
let whitList = ['http://localhost:3000'] //设置白名单
app.use(function(req, res, next) {
  let origin = req.headers.origin
  if (whitList.includes(origin)) {
    // 设置哪个源可以访问我
    res.setHeader('Access-Control-Allow-Origin', origin)
    // 允许携带哪个头访问我
    res.setHeader('Access-Control-Allow-Headers', 'name')
    // 允许哪个方法访问我
    res.setHeader('Access-Control-Allow-Methods', 'PUT')
    // 允许携带cookie
    res.setHeader('Access-Control-Allow-Credentials', true)
    // 预检的存活时间
    res.setHeader('Access-Control-Max-Age', 6)
    // 允许返回的头
    res.setHeader('Access-Control-Expose-Headers', 'name')
    if (req.method === 'OPTIONS') {
      res.end() // OPTIONS请求不做任何处理
    }
  }
  next()
})
app.put('/getData', function(req, res) {
  console.log(req.headers)
  res.setHeader('name', 'jw') //返回一个响应头，后台需设置
  res.end('我不爱你')
})
app.get('/getData', function(req, res) {
  console.log(req.headers)
  res.end('我不爱你')
})
app.use(express.static(__dirname))
app.listen(4000)
```

### 3. postMessage
postMessage是HTML5 XMLHttpRequest Level 2中的API，且是为数不多可以跨域操作的window属性之一，它可用于解决以下方面的问题：

- 页面和其打开的新窗口的数据传递
- 多窗口之间消息传递
- 页面与嵌套的iframe消息传递
- 上面三个场景的跨域数据传递<br>
> **postMessage()方法允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递。**

otherWindow.postMessage(message, targetOrigin, [transfer]);
message: 将要发送到其他 window的数据。
targetOrigin:通过窗口的origin属性来指定哪些窗口能接收到消息事件，其值可以是字符串"*"（表示无限制）或者一个URI。在发送消息的时候，如果目标窗口的协议、主机地址或端口这三者的任意一项不匹配targetOrigin提供的值，那么消息就不会被发送；只有三者完全匹配，消息才会被发送。
transfer(可选)：是一串和message 同时传递的 Transferable 对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权。

### 4. websocket
Websocket是HTML5的一个持久化的协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。WebSocket和HTTP都是应用层协议，都基于 TCP 协议。但是 **WebSocket 是一种双向通信协议，在建立连接之后，WebSocket 的 server 与 client 都能主动向对方发送或接收数据。** 同时，WebSocket 在建立连接时需要借助 HTTP 协议，连接建立好了之后 client 与 server 之间的双向通信就与 HTTP 无关了。

原生WebSocket API使用起来不太方便，我们使用Socket.io，它很好地封装了webSocket接口，提供了更简单、灵活的接口，也对不支持webSocket的浏览器提供了向下兼容。

### 5. Node中间件代理(两次跨域)
实现原理：同源策略是浏览器需要遵循的标准，而如果是服务器向服务器请求就无需遵循同源策略。<br>

代理服务器，需要做以下几个步骤：
- 接受客户端请求 。
- 将请求 转发给服务器。
- 拿到服务器 响应 数据。
- 将 响应 转发给客户端。
![avatar](data:image/webp;base64,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)

### 6. nginx反向代理
实现原理类似于Node中间件代理，需要你搭建一个中转nginx服务器，用于转发请求。

使用nginx反向代理实现跨域，是最简单的跨域方式。只需要修改nginx的配置即可解决跨域问题，支持所有浏览器，支持session，不需要修改任何代码，并且不会影响服务器性能。

实现思路：通过nginx配置一个代理服务器（域名与domain1相同，端口不同）做跳板机，反向代理访问domain2接口，并且可以顺便修改cookie中domain信息，方便当前域cookie写入，实现跨域登录。

### 7. window.name + iframe
window.name属性的独特之处：name值在不同的页面（甚至不同域名）加载后依旧存在，并且可以支持非常长的 name 值（2MB）。

其中a.html和b.html是同域的，都是http://localhost:3000;而c.html是http://localhost:4000

### 8. location.hash + iframe

实现原理： a.html欲与c.html跨域相互通信，通过中间页b.html来实现。 三个页面，不同域之间利用iframe的location.hash传值，相同域之间直接js访问来通信。

具体实现步骤：一开始a.html给c.html传一个hash值，然后c.html收到hash值后，再把hash值传递给b.html，最后b.html将结果放到a.html的hash值中。

### 9. document.domain + iframe
该方式只能用于二级域名相同的情况下，比如 a.test.com 和 b.test.com 适用于该方式。
只需要给页面添加 document.domain ='test.com' 表示二级域名都相同就可以实现跨域。

实现原理：两个页面都通过js强制设置document.domain为基础主域，就实现了同域。

我们看个例子：页面a.zf1.cn:3000/a.html获取页面b.zf1.cn:3000/b.html中a的值

## 总结
- CORS支持所有类型的HTTP请求，是跨域HTTP请求的根本解决方案
- JSONP只支持GET请求，JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。
- 不管是Node中间件代理还是nginx反向代理，主要是通过同源策略对服务器不加限制。
- 日常工作中，用得比较多的跨域方案是cors和nginx反向代理

<br>
参考：
  https://segmentfault.com/a/1190000018017118


