# <center> 基础汇总3 </center>

## 9. 浏览器输入url到页面加载完成发生了什么
<image src="https://cdn.nlark.com/yuque/0/2018/png/179061/1544752427010-3ece817b-ab44-413a-b31d-65ebc096ccbf.png"/>

https://www.yuque.com/jiuzaijiyilihuayigecha/cte0k5/flw0xm

DNS域名解析 —> TCP链接 —> HTML资源下载 —> 解析 —> 页面渲染

### 9.1 DNS域名解析
域名系统 DNS (Domain Name System)，是应用层协议。具体过程如下：

    ①用户主机上运行着DNS的客户端，就是我们的PC机或者手机客户端运行着DNS客户端了
    ②浏览器将接收到的url中抽取出域名字段，就是访问的主机名，比如
      http://www.baidu.com/, 
    并将这个主机名传送给DNS应用的客户端
    ③DNS客户机端向DNS服务器端发送一份查询报文，报文中包含着要访问的主机名字段（中间包括一些列缓存查询以及分布式DNS集群的工作）
    ④该DNS客户机最终会收到一份回答报文，其中包含有该主机名对应的IP地址
    ⑤一旦该浏览器收到来自DNS的IP地址，就可以向该IP地址定位的HTTP服务器发起TCP连接。

通过下面路径根据域名找对应的ip地址:
          
    客户端DNS缓存: 浏览器缓存->系统DNS缓存、Hosts文件->路由器缓存
    ISP（互联网服务提供商）DNS缓存
    根域名服务器：全球仅有13台根域名服务器，1个主根域名服务器，其余12为辅根域名服务器
    顶级域名服务器：顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的IP地址告诉本地DNS服务器
    主域名服务器：主域名服务器接受到请求后查询自己的缓存
    保存结果至缓存：本地域名服务器把返回的结果保存到缓存，以备下一次使用

**[DNS 是基于 UDP 做的查询](https://www.zhihu.com/question/22587247/answer/66417484)**: 这样的无连接的，尽最大能力交付的不可靠数据连接。一次UDP服务器交换可以短到两个包: 一个查询包、一个响应包。一次TCP交换则至少包含9个包：三次握手初始化TCP会话、一个查询包、一个响应包以及四次分手的包交换。

### 9.2 TCP三次握手


**为什么要三次握手**: 为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误.